<div id="artwork-request-<%= artwork_request.id %>" class="row">
  <div class="the-notes info artwork-request-notes">
    <% unless artwork_request.artwork_ids.empty? %>
      <%= render 'artwork_requests/artworks', artwork_request: artwork_request %>
    <% end %>
    
    <br clear="all" />
    <div class="row">
      <h4 class="artwork-request-title">Artwork Request for <%= artwork_request.jobs.map(&:name).join(', ') %>
      </h4>

      <% if artwork_request.reorder? %>
        <div class="alert alert-warning">
          This artwork request is for an exact reorder.
          <ul>
            <li>Description
            </li>
            <li><%= artwork_request.description %>
            </li>
          </ul>
          <br clear="all" />
        </div>
      <% end %>
    </div>

    <div class="row">
      <%= render 'artwork_requests/show/basic_details', { artwork_request: artwork_request, full: true} %>
    </div>

    <h4 class='artwork-request-title'> Imprints for this Artwork Request</h4>

    <table class="table table-condensed table-bordered">
      <tr>
        <th>Job ID
        </th>
        <th>Quantity
        </th>
        <th>Imprint Location
        </th>
        <th>Max Ideal Size
        </th>
        <th>Template
        </th>
        <th>Style
        </th>
        <th>Colors
        </th>
      </tr>
      <% artwork_request.jobs.each do |job| %>
        <% background_color = cycle('background-color: #fff', 'background-color: #f9f9f9') %>
        <tr style="<%= background_color %>">
          <% rowspan = job.imprintables_for_order.count %>
          <td rowspan="<%= rowspan %>"><%= job.id %>
          </td>
          <td rowspan="<%= rowspan %>"><%= job.imprintable_variant_count %>
          </td>
          <td rowspan="<%= rowspan %>"><%= artwork_request.print_location_names_for_job(job).join(", ") %>
          </td>
          <td rowspan="<%= rowspan %>">
            <% max = artwork_request.max_ideal_print_location_size_for_job(job) %>
            <%= max[:width] %>" wide X <%= max[:height] %>" tall
          </td>
          <% imprintable_proofing_templates = artwork_request.imprintable_proofing_templates_for_job(job) %>
          <% imprintable_proofing_templates.each_with_index do |ipt, i| %>
            <% imprintables = artwork_request.imprintables_for_job_with_proofing_template(job, ipt) %> 
            <% if imprintable_proofing_templates.size > 1 && i > 0 %>
              <tr style="<%= background_color %>">
            <% end %>

            <td rowspan="<%= imprintables.size %>"><%= ipt.blank? ? "No Template Defined" : ipt %>
            </td>
            <% imprintables.each_with_index do |imprintable, j| %>
              <td>
                <%= link_to "#{imprintable.brand_name} #{imprintable.style_catalog_no}", imprintable.supplier_link %>
              </td>
              <td><%= raw artwork_request.colors_for_imprintable_for_job(imprintable, job).join("<br />") %>
              </td>
            </tr>
          <% end %>
        <% end %>
      <% end %>
    </table>

    <div class="row artwork-request-actions">
      <dl>
        <dt>Description:
        </dt><br />
        <dd><%= artwork_request.description.html_safe %>
        </dd>
        <br />
        <dt>Attachments:
        </dt>
        <% if artwork_request.assets.empty? %>
          <dd>None</dd>
        <% end %>
      </dl>
      <% artwork_request.assets.each do |asset| %>
        <div class="col-sm-5 indent">
          <dl>
            <dt>File Name:
            </dt>
            <dd><%= asset.file_file_name %>
            </dd>
            <dt>File Size:
            </dt>
            <dd><%= number_to_human_size(asset.file_file_size) %>
            </dd>
            <dt>Description:
            </dt>
            <dd><%= asset.description %>
            </dd>
            <dd><%= link_to 'Download File', asset.file.url %>
            </dd>
          </dl>
        </div>
      <% end %>
    </div><!-- end of .artwork-request-actions  -->

    <div class="row">
      <div class="col-sm-12">
        <%= link_to edit_order_artwork_request_path(order, artwork_request) do %>
          <i class="fa fa-2x fa-edit"></i> Edit &nbsp
        <% end %>

        <%= link_to order_artwork_request_path(order, artwork_request), method: :delete, remote: true do %>
          <i class="fa fa-2x danger fa-times-circle"></i> Delete &nbsp
        <% end %>

        <% if artwork_request.state == 'pending_manager_approval' %>
          <%= link_to order_artwork_request_path(artwork_request.order, artwork_request, artwork_request: { state: 'manager_approved'} ), 
            method: :put, data: {action: :update, toggle: :tooltip,
            title: 'Approve',  confirm: "Confirm Manager Approval" } do %>
          <i class="glyphicon glyphicon-thumbs-up"></i> Approve
          <% end %>
        <% end %>

        <% if artwork_request.state == 'pending_manager_approval' || artwork_request.state == 'manager_approved' %>
          <%= link_to order_artwork_request_path(artwork_request.order, artwork_request, artwork_request: { state: 'pending_artwork' }), 
            method: :put, method: :put, data: {action: :update, toggle: :tooltip,
            title: 'Rejext',  confirm: "Confirm Rejection" } do %>
            <i class="glyphicon glyphicon-thumbs-down"></i> Reject
          <% end %>
        <% end %>

        <% if params[:disable_buttons].nil? %>
          <%= link_to artworks_path(artwork_request_id: artwork_request.id), remote: true do %>
            <i class="fa fa-2x success fa-plus-circle"></i> Add Artwork &nbsp
          <% end %>
        <% end %>
      </div><!-- end of col-sm-12 -->
    </div><!-- end of row -->

  </div><!-- END OF THE ARTWORK REQUEST -->
</div><!-- END OF THE NOTES -->

