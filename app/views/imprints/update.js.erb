var handler;
var shineEditingIn = function ($container) {
  $editing = $container.find('.editing-imprint');
  
  if ($editing.length) {
    $editing.each(function() {
      $(this).removeClass('editing-imprint');
      $(this).find('.js-imprint-has-name-number').removeData('original-value');
      shine($(this), true);
    });
  }
}

<% @imprints.each do |imprint| %>

  var $container = $(".imprint-entry[data-id='<%= imprint.id %>']");
  var $printLocation = $container.find('.print-location-container');
  handler = errorHandlerFrom($printLocation, 'imprint', $printLocation, <%= imprint.id %>);

  <% if imprint.valid? %>    

    handler.clear();
    shineEditingIn($container);

  <% else %>

    handler.handleErrors(<%= imprint.errors.messages.to_json.html_safe %>);

  <% end %>
<% end %>

<% @new_imprints.each do |new_imprint| %>
  
  var $container = $(".imprint-entry[data-id='<%= new_imprint.attributes_key %>']");
  var $printLocation = $container.find('.print-location-container');
  handler = errorHandlerFrom($printLocation, 'imprint', $printLocation, <%= new_imprint.attributes_key %>);

  <% if new_imprint.valid? %>
    
    handler.clear();
    $container.attr('data-id', <%= new_imprint.id %>);
    $container.find('.js-print-location-select').attr(
      'name', "imprint[<%= new_imprint.id %>[print_location_id]]"
    );
    shineEditingIn($container);

  <% else %>
    
    handler.handleErrors(<%= new_imprint.errors.messages.to_json.html_safe %>);

  <% end %>

<% end %>

<%= update_order_timeline(@job.order) %>
