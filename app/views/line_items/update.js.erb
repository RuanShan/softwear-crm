<% @line_items.each do |line_item| %>
  <% if line_item.imprintable? %>
    var $container = $("#edit-line-item-<%= line_item.id %>");

    <% if line_item.valid? %>
      if ($container.hasClass('editing-line-item')) {
        $container.removeClass('editing-line-item');

        var $inputs = $container.find('input');
        shine($inputs, true);
        shine($container, false);
      }

    <% else %>

      errorHandlerFrom($container, 'line_item', $container, <%= line_item.id %>)
        .handleErrors(
          <%= line_item.errors.messages.to_json.html_safe %>,
          "<%= j render partial: 'shared/modal_errors',
                        locals: { object: line_item } %>"
        );
    <% end %>

  <% else %>

    var $row = $("#line-item-<%= line_item.id %>");

    <% if line_item.valid? %>    
      var $oldChildren = $row.children();

      $oldChildren.each(function() {
        $(this).remove();
      });

      $row.append(
        "<%= j render partial: 'standard_view_entry',
                      locals: { line_item: line_item } %>"
      );

      var $inputs = $row.find('input');
      shine($inputs, true);
      shine($row, false);

    <% else %>

      errorHandlerFrom($row, 'line_item', $row, <%= line_item.id %>)
        .handleErrors(<%= line_item.errors.messages.to_json.html_safe %>);
    <% end %>
  <% end %>
<% end %>

<% unless @line_items.empty? %>
  <%= update_order_timeline(@line_items.first.line_itemable.try(:order)) %>
<% end %>
